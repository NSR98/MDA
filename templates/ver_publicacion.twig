{% extends 'base/base.html.twig' %}

{% block body %}
    <div class="container">
        <a href="{{ path('foro') }}" class="btn btn-sm btn-secondary mt-5">Volver al foro</a>
        <h2 class="mt-3">{{ publicacion.titulo }}</h2>
        <div class="card mt-3 mb-3" style="background-color: #e2daff;">
            <div class="card-header">{{ usuarios[publicacion.id_usuario].name }}</div>
            <div class="card-body">{{ publicacion.descripcion }}</div>
            <div class="card-footer">{{ publicacion.fecha }}</div>
        </div>

        <a href="{{ path('crear_respuesta', {"id" : publicacion.id}) }}" class="btn btn-primary mt-3">Añadir respuesta</a>
        <a href="{{ path('ver_usuario', {"id" : publicacion.id_usuario}) }}" class="btn btn-dark mt-3">Ver usuario</a>

        {% for respuesta in respuestas %}
            <div class="card ml-5 mb-3 mt-3 answer">
                <div class="card-header">{{ usuarios[respuesta.id_usuario].name }}</div>
                <div class="card-body">{{ respuesta.respuesta }}</div>
                <div class="card-footer">{{ respuesta.fecha }}
                {% if is_granted("ROLE_ADMIN") or app.user.id == respuesta.id_usuario %}
                    <a href="{{ path('editar_respuesta', {'id': respuesta.id }) }}" class="btn btn-primary btn-sm ml-1 float-right"><i class="fas fa-edit"></i></a>
                    <button class="btn btn-sm btn-danger float-right" onclick="deleteRespuesta({{ respuesta.id }})"><i class="fa fas fa-trash-alt"></i></button>
                {% endif %}
                </div>
            </div>
        {% else %}
            <h4 class="text-danger my-3">Aún no hay respuestas para este hilo, ¡Sé el primero!</h4>
        {% endfor %}


    </div>
{% endblock %}

{% block title %}
    {{ publicacion.titulo }}
{% endblock %}

{% block js %}
    <script type="text/javascript">
        function deleteRespuesta(id) {
            bootbox.confirm("¿Seguro que deseas borrar la respuesta?", function (result) {
                if (result) {
                    $.ajax({
                        method: 'POST',
                        url: '{{ path('borrar_respuesta') }}',
                        data: {
                            "id": id,
                        },
                        success: function (data) {
                            console.log(data)
                            if (data.content) {
                                location.reload()
                            } else {
                                bootbox.alert("Hubo un error al borrar la respuesta. Por favor, inténtalo de nuevo más tarde.");
                            }
                        },
                        error: function () {
                            bootbox.alert("Hubo un error al borrar la respuesta. Por favor, inténtalo de nuevo más tarde.")
                        }
                    });
                }
            });
        }
    </script>
{% endblock %}
