{% extends 'base/base.html.twig' %}

{% block body %}
    <div class="card mx-auto mt-5" style="max-width: 1200px;">
        <div class="row no-gutters">
            <div class="col-md-4">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/User_icon_2.svg/1024px-User_icon_2.svg.png" class="card-img" alt="user">
            </div>
            <div class="col-md-8 mt-5">
                <div class="card-body">
                    <h5 class="card-title">{{ usuario.name }}</h5>
                    <p class="card-text">{{ usuario.surname }}</p>
                    <p class="card-text"><small class="text-muted">{{ usuario.email }}</small></p>
                </div>
            </div>
        </div>

        <div class="card-footer">
            <button class="btn btn-info" type="button" data-toggle="collapse" data-target=".multi-collapse" aria-expanded="false" aria-controls="collapsePublications collapseAnswers">Ver actividad</button>

        {% if is_granted("ROLE_ADMIN") %}
                <a href="{{ path('modificar_perfil', {'id': usuario.id }) }}" class="btn btn-primary btn-sm mx-auto float-right"><i class="fas fa-edit"></i></a>
                <button class="btn btn-danger btn-sm mx-auto float-right" onclick="deleteUser({{ usuario.id }})"><i class="fas fa-trash-alt"></i></button>
            </div>
        {% elseif app.user.id == usuario.id %}
                <a href="{{ path('modificar_perfil', {'id': usuario.id }) }}" class="btn btn-primary btn-sm mx-auto float-right">Modificar perfil</a>
            </div>
        {% elseif app.user.id != usuario.id %}
                <a href="{{ path('crear_mensaje', {'id': usuario.id }) }}" class="btn btn-primary btn-sm mx-auto float-right"><i class="fas fa-envelope"></i></a>
            </div>
        {% endif %}
    </div>

    <div class="collapse multi-collapse m-5" id="collapsePublications">
        <h3>Publicaciones </h3>
        <div class="card-columns">
            <div class="card p-3">
                <div class="card-body">
                    <h4 class="card-title">Título 1</h4>
                    <p class="card-text">Descripción</p>
                    <p class="card-text text-muted">Fecha</p>
                    <a class="btn btn-info float-right" href="#">Visitar</a>
                </div>
            </div>
            <div class="card p-3">
                <div class="card-body">
                    <h4 class="card-title">Título 2</h4>
                    <p class="card-text">Descripción</p>
                    <p class="card-text text-muted">Fecha</p>
                    <a class="btn btn-info float-right" href="#">Visitar</a>
                </div>
            </div>
            <div class="card p-3">
                <div class="card-body">
                    <h4 class="card-title">Título 2</h4>
                    <p class="card-text">Descripción</p>
                    <p class="card-text text-muted">Fecha</p>
                    <a class="btn btn-info float-right" href="#">Visitar</a>
                </div>
            </div>
        </div>
    </div>

    <div class="collapse multi-collapse m-5" id="collapseAnswers">
        <h3>Respuestas</h3>
        <div class="card-columns">
            <div class="card p-3">
                <div class="card-body">
                    <h4 class="card-title">Respuesta 1</h4>
                    <p class="card-text text-muted">Fecha</p>
                    <a class="btn btn-info float-right" href="#">Ver contexto</a>
                </div>
            </div>
            <div class="card p-3">
                <div class="card-body">
                    <h4 class="card-title">Respuesta 1</h4>
                    <p class="card-text text-muted">Fecha</p>
                    <a class="btn btn-info float-right" href="#">Ver contexto</a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block title %}
    Ver usuario - Politicum
{% endblock %}

{% block js %}
    <script type="text/javascript">
        function deleteUser(id) {
            bootbox.confirm("¿Seguro que deseas borrar al usuario?", function(result){
                if (result) {
                    $.ajax({
                        method: 'POST',
                        url: '{{ path('borrar_usuario') }}',
                        data: {
                            "id" : id,
                        },
                        success: function(data) {
                            if (data.content) {
                                bootbox.alert("Usuario borrado con éxito.", function(){
                                    window.location.replace("/MDA/listar_usuarios");
                                });
                            } else {
                                bootbox.alert("Hubo un error al borrar el usuario. Por favor, inténtalo de nuevo más tarde.");
                            }
                        },
                        error: function() {
                            bootbox.alert("Hubo un error al borrar el usuario. Por favor, inténtalo de nuevo más tarde.")
                        }
                    });
                }
            });
        }
    </script>
{% endblock %}
